name: picoopentherm

volumes:
  mosquitto-data:
  mosquitto-log:
  homeassistant-config:

services:
  # Mosquitto MQTT Broker
  mosquitto:
    image: eclipse-mosquitto:latest
    restart: unless-stopped
    ports:
      - "1883:1883"  # MQTT
      - "9001:9001"  # WebSocket
    volumes:
      - ./mosquitto/config:/mosquitto/config
      - mosquitto-data:/mosquitto/data
      - mosquitto-log:/mosquitto/log
    networks:
      - picoopentherm

  # Home Assistant
  homeassistant:
    image: homeassistant/home-assistant:latest
    restart: unless-stopped
    privileged: true
    ports:
      - "8123:8123"  # Home Assistant Web UI
    volumes:
      - homeassistant-config:/config
      - ./homeassistant/configuration.yaml:/config/configuration.yaml
      - ./homeassistant/automations.yaml:/config/automations.yaml
      - ./homeassistant/scenes.yaml:/config/scenes.yaml
      - ./homeassistant/scripts.yaml:/config/scripts.yaml
      - ./homeassistant/secrets.yaml:/config/secrets.yaml
      - ./homeassistant/ui-lovelace.yaml:/config/ui-lovelace.yaml
      - ./homeassistant/lovelace:/config/lovelace
      - /etc/localtime:/etc/localtime:ro
    environment:
      - TZ=Europe/London
    networks:
      - picoopentherm
    depends_on:
      - mosquitto

  # MQTT Explorer for debugging
  mqtt-explorer:
    image: smeagolworms4/mqtt-explorer
    restart: unless-stopped
    ports:
      - "4000:4000"  # MQTT Explorer Web UI
    environment:
      - HTTP_PORT=4000
      - CONFIG_PATH=/mqtt-explorer/config.json
    networks:
      - picoopentherm
    depends_on:
      - mosquitto

networks:
  picoopentherm:
    driver: bridge
