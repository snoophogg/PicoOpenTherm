# OpenTherm Gateway - Individual Entity Cards
# Standalone cards for each entity type

# === STATUS CARDS ===

# Flame Status Card
type: entity
entity: binary_sensor.opentherm_gw_flame
name: Burner Flame
icon: mdi:fire

---

# Fault Status Card with Alert
type: conditional
conditions:
  - entity: binary_sensor.opentherm_gw_fault
    state: "on"
card:
  type: markdown
  content: |
    ## ‚ö†Ô∏è System Fault Detected
    **Fault Code:** {{ states('sensor.opentherm_gw_fault_code') }}
    
    Please check your boiler display for more information.
  card_mod:
    style: |
      ha-card {
        background: rgba(255, 0, 0, 0.1);
        border: 2px solid red;
      }

---

# === CONTROL CARDS ===

# Central Heating Switch Card
type: button
entity: switch.opentherm_gw_ch_enable
name: Central Heating
icon: mdi:radiator
show_state: true
tap_action:
  action: toggle
hold_action:
  action: more-info

---

# Control Setpoint Card
type: gauge
entity: sensor.opentherm_gw_boiler_temp
name: Boiler Temperature
min: 0
max: 100
needle: true
segments:
  - from: 0
    color: '#3498db'
  - from: 40
    color: '#2ecc71'
  - from: 70
    color: '#f39c12'
  - from: 85
    color: '#e74c3c'

---

# === TEMPERATURE CARDS ===

# Multi-Temperature Card
type: entities
title: Temperature Overview
show_header_toggle: false
entities:
  - type: custom:multiple-entity-row
    entity: sensor.opentherm_gw_boiler_temp
    name: Boiler Circuit
    icon: mdi:thermometer
    secondary_info: last-changed
    entities:
      - entity: sensor.opentherm_gw_return_temp
        name: Return
  - type: custom:multiple-entity-row
    entity: sensor.opentherm_gw_dhw_temp
    name: Hot Water
    icon: mdi:water-thermometer
    secondary_info: last-changed
    entities:
      - entity: number.opentherm_gw_dhw_setpoint
        name: Target
  - type: custom:multiple-entity-row
    entity: sensor.opentherm_gw_room_temp
    name: Room
    icon: mdi:home-thermometer
    secondary_info: last-changed
    entities:
      - entity: sensor.opentherm_gw_outside_temp
        name: Outside

---

# Boiler Temperature Card with Setpoint
type: thermostat
entity: number.opentherm_gw_control_setpoint
name: CH Water Setpoint

---

# === PERFORMANCE CARDS ===

# Modulation Gauge
type: gauge
entity: sensor.opentherm_gw_modulation
name: Modulation Level
unit: "%"
min: 0
max: 100
severity:
  green: 0
  yellow: 50
  red: 80

---

# Modulation Bar Card (requires bar-card from HACS)
type: custom:bar-card
entity: sensor.opentherm_gw_modulation
name: Modulation Level
icon: mdi:percent
unit_of_measurement: "%"
min: 0
max: 100
color: rgb(114, 119, 255)
positions:
  icon: outside
  indicator: inside
  name: inside
  value: inside

---

# Water Pressure Card
type: sensor
entity: sensor.opentherm_gw_pressure
name: CH Water Pressure
graph: line
detail: 2
hours_to_show: 24

---

# === STATISTICS CARDS ===

# Counter Statistics Card
type: entities
title: System Statistics
entities:
  - type: custom:bar-card
    entity: sensor.opentherm_gw_burner_hours
    name: Burner Hours
    icon: mdi:clock-outline
    max: 10000
    positions:
      icon: outside
      name: inside
      value: inside
  - type: custom:bar-card
    entity: sensor.opentherm_gw_ch_pump_hours
    name: CH Pump Hours
    icon: mdi:clock-outline
    max: 10000
    positions:
      icon: outside
      name: inside
      value: inside
  - type: custom:bar-card
    entity: sensor.opentherm_gw_dhw_pump_hours
    name: DHW Pump Hours
    icon: mdi:clock-outline
    max: 10000
    positions:
      icon: outside
      name: inside
      value: inside

---

# Statistics Glance Card
type: glance
title: Operating Counters
columns: 3
entities:
  - entity: sensor.opentherm_gw_burner_starts
    name: Burner Starts
  - entity: sensor.opentherm_gw_ch_pump_starts
    name: CH Starts
  - entity: sensor.opentherm_gw_dhw_pump_starts
    name: DHW Starts

---

# === DIAGNOSTIC CARDS ===

# System Configuration Card
type: markdown
content: |
  ## System Configuration
  
  **DHW Present:** {{ states('binary_sensor.opentherm_gw_dhw_present') }}
  **Cooling Supported:** {{ states('binary_sensor.opentherm_gw_cooling_supported') }}
  **CH2 Present:** {{ states('binary_sensor.opentherm_gw_ch2_present') }}
  **OpenTherm Version:** {{ states('sensor.opentherm_gw_opentherm_version') }}
  
  ---
  
  **Last Update:** {{ relative_time(states.binary_sensor.opentherm_gw_flame.last_changed) }} ago

---

# === MINI CARDS ===

# Mini Flame Indicator
type: custom:mushroom-entity-card
entity: binary_sensor.opentherm_gw_flame
name: Flame
icon: mdi:fire
tap_action:
  action: more-info
card_mod:
  style: |
    ha-card {
      {% if is_state('binary_sensor.opentherm_gw_flame', 'on') %}
        background: rgba(255, 152, 0, 0.1);
      {% endif %}
    }

---

# Mini Temperature Card
type: custom:mushroom-template-card
primary: "{{ states('sensor.opentherm_gw_boiler_temp') }}¬∞C"
secondary: Boiler Temperature
icon: mdi:thermometer
icon_color: |
  {% set temp = states('sensor.opentherm_gw_boiler_temp')|float %}
  {% if temp < 40 %}
    blue
  {% elif temp < 70 %}
    green
  {% elif temp < 85 %}
    orange
  {% else %}
    red
  {% endif %}
tap_action:
  action: more-info
  entity: sensor.opentherm_gw_boiler_temp

---

# Mini Modulation Card
type: custom:mushroom-template-card
primary: "{{ states('sensor.opentherm_gw_modulation') }}%"
secondary: Modulation
icon: mdi:percent
icon_color: |
  {% set mod = states('sensor.opentherm_gw_modulation')|float %}
  {% if mod < 30 %}
    blue
  {% elif mod < 70 %}
    green
  {% else %}
    orange
  {% endif %}
tap_action:
  action: more-info
  entity: sensor.opentherm_gw_modulation

---

# === TIME & DATE CARDS ===

# Boiler Time Card
type: markdown
content: |
  ## üïê Boiler Time & Date

  **Day:** {{ states('sensor.opentherm_gw_day_of_week') }}
  **Time:** {{ states('sensor.opentherm_gw_time_of_day') }}
  **Date:** {{ states('sensor.opentherm_gw_date') }}
  **Year:** {{ states('sensor.opentherm_gw_year') }}

  ---

  **System Time:** {{ now().strftime('%A, %H:%M') }}
  **System Date:** {{ now().strftime('%m/%d/%Y') }}

---

# Time Sync Button Card
type: button
entity: button.opentherm_gw_sync_time
name: Sync Time to Boiler
icon: mdi:clock-sync
show_state: false
tap_action:
  action: call-service
  service: button.press
  target:
    entity_id: button.opentherm_gw_sync_time
  confirmation:
    text: Sync current time to boiler?

---

# Time Comparison Card (requires card-mod)
type: markdown
content: |
  ## ‚è∞ Time Synchronization

  {% set boiler_time = states('sensor.opentherm_gw_time_of_day') %}
  {% set system_time = now().strftime('%H:%M') %}

  **Boiler Time:** {{ boiler_time }}
  **System Time:** {{ system_time }}

  {% if boiler_time == system_time %}
  ‚úÖ Times are synchronized
  {% elif boiler_time in ['unknown', 'unavailable'] %}
  ‚ö†Ô∏è Boiler time not available
  {% else %}
  ‚ö†Ô∏è Times may differ - consider syncing
  {% endif %}

  *Last sync: {{ relative_time(states.button.opentherm_gw_sync_time.last_changed) }} ago*

---

# === WIFI & NETWORK CARDS ===

# WiFi Signal Gauge
type: gauge
entity: sensor.opentherm_gw_wifi_rssi
name: WiFi Signal
min: -100
max: -30
severity:
  red: -100
  yellow: -70
  green: -50
needle: true

---

# WiFi Status Card
type: markdown
content: |
  ## üì∂ WiFi Connection

  **Status:** {{ states('sensor.opentherm_gw_wifi_link_status') }}
  **Signal:** {{ states('sensor.opentherm_gw_wifi_rssi') }} dBm
  **Network:** {{ states('sensor.opentherm_gw_wifi_ssid') }}
  **IP Address:** {{ states('sensor.opentherm_gw_ip_address') }}

  {% set rssi = states('sensor.opentherm_gw_wifi_rssi')|int %}
  {% if rssi > -50 %}
  ‚úÖ Excellent signal
  {% elif rssi > -60 %}
  ‚úÖ Good signal
  {% elif rssi > -70 %}
  ‚ö†Ô∏è Fair signal
  {% else %}
  ‚ö†Ô∏è Weak signal
  {% endif %}

---

# Network Mini Card
type: glance
title: Network Status
columns: 2
entities:
  - entity: sensor.opentherm_gw_wifi_rssi
    name: Signal
  - entity: sensor.opentherm_gw_wifi_link_status
    name: Status

---

# === SYSTEM HEALTH CARDS ===

# System Uptime Card
type: sensor
entity: sensor.opentherm_gw_uptime
name: Gateway Uptime
graph: line
detail: 2
hours_to_show: 168  # 1 week

---

# Memory Usage Card
type: markdown
content: |
  ## üíæ System Resources

  **Free Memory:** {{ states('sensor.opentherm_gw_free_heap') }} bytes
  **Uptime:** {{ (states('sensor.opentherm_gw_uptime')|int / 3600) | round(1) }} hours

  {% set uptime_hours = (states('sensor.opentherm_gw_uptime')|int / 3600) %}
  {% if uptime_hours < 1 %}
  ‚ÑπÔ∏è Recently restarted
  {% elif uptime_hours < 24 %}
  ‚úÖ Running smoothly
  {% else %}
  ‚úÖ Stable for {{ (uptime_hours / 24) | round(0) }} days
  {% endif %}

---

# System Health Glance
type: glance
title: System Health
columns: 3
entities:
  - entity: sensor.opentherm_gw_uptime
    name: Uptime
  - entity: sensor.opentherm_gw_free_heap
    name: Memory
  - entity: sensor.opentherm_gw_opentherm_version
    name: Version

---

# Restart Gateway Button
type: button
entity: button.opentherm_gw_restart
name: Restart Gateway
icon: mdi:restart
show_state: false
tap_action:
  action: call-service
  service: button.press
  target:
    entity_id: button.opentherm_gw_restart
  confirmation:
    text: Are you sure you want to restart the OpenTherm Gateway? This will briefly interrupt boiler communication.
card_mod:
  style: |
    ha-card {
      background: rgba(255, 152, 0, 0.1);
      border: 1px solid orange;
    }

---

# === CONFIGURATION CARDS ===

# Temperature Bounds Info Card
type: markdown
content: |
  ## üå°Ô∏è Temperature Limits

  ### Central Heating
  **Min:** {{ states('sensor.opentherm_gw_ch_setpoint_min') }}¬∞C
  **Max:** {{ states('sensor.opentherm_gw_ch_setpoint_max') }}¬∞C
  **Current Max:** {{ states('number.opentherm_gw_max_ch_setpoint') }}¬∞C

  ### Hot Water
  **Min:** {{ states('sensor.opentherm_gw_dhw_setpoint_min') }}¬∞C
  **Max:** {{ states('sensor.opentherm_gw_dhw_setpoint_max') }}¬∞C
  **Current:** {{ states('number.opentherm_gw_dhw_setpoint') }}¬∞C

---

# Gateway Settings Card
type: entities
title: Gateway Settings
entities:
  - entity: text.opentherm_gw_device_name
    name: Device Name
  - entity: text.opentherm_gw_device_id
    name: Device ID
  - entity: number.opentherm_gw_update_interval
    name: Update Interval
  - type: divider
  - entity: number.opentherm_gw_opentherm_tx_pin
    name: TX Pin
  - entity: number.opentherm_gw_opentherm_rx_pin
    name: RX Pin

---

# === COMPREHENSIVE DASHBOARD CARDS ===

# Complete System Status Card
type: entities
title: Complete System Status
show_header_toggle: false
entities:
  - type: section
    label: Status
  - entity: binary_sensor.opentherm_gw_fault
    name: Fault
  - entity: binary_sensor.opentherm_gw_flame
    name: Flame
  - entity: binary_sensor.opentherm_gw_ch_mode
    name: CH Active
  - entity: binary_sensor.opentherm_gw_dhw_mode
    name: DHW Active
  - type: section
    label: Temperatures
  - entity: sensor.opentherm_gw_boiler_temp
    name: Boiler
  - entity: sensor.opentherm_gw_dhw_temp
    name: Hot Water
  - entity: sensor.opentherm_gw_room_temp
    name: Room
  - entity: sensor.opentherm_gw_outside_temp
    name: Outside
  - type: section
    label: Performance
  - entity: sensor.opentherm_gw_modulation
    name: Modulation
  - entity: sensor.opentherm_gw_pressure
    name: Pressure
  - type: section
    label: Time & Network
  - entity: sensor.opentherm_gw_time_of_day
    name: Boiler Time
  - entity: sensor.opentherm_gw_wifi_link_status
    name: WiFi Status

---

# Quick Actions Card
type: entities
title: Quick Actions
show_header_toggle: false
entities:
  - entity: switch.opentherm_gw_ch_enable
    name: Central Heating
  - entity: switch.opentherm_gw_dhw_enable
    name: Hot Water
  - type: divider
  - entity: button.opentherm_gw_sync_time
    name: Sync Time
  - entity: button.opentherm_gw_restart
    name: Restart Gateway

---

# Combined Time & WiFi Status
type: vertical-stack
cards:
  - type: markdown
    content: |
      ### ‚è∞ {{ states('sensor.opentherm_gw_time_of_day') }} - {{ states('sensor.opentherm_gw_day_of_week') }}
      {{ states('sensor.opentherm_gw_date') }}/{{ states('sensor.opentherm_gw_year') }}
  - type: entities
    entities:
      - entity: button.opentherm_gw_sync_time
        name: Sync Time
  - type: horizontal-stack
    cards:
      - type: gauge
        entity: sensor.opentherm_gw_wifi_rssi
        name: WiFi
        min: -100
        max: -30
        severity:
          red: -100
          yellow: -70
          green: -50
        needle: true
      - type: markdown
        content: |
          **{{ states('sensor.opentherm_gw_wifi_ssid') }}**
          {{ states('sensor.opentherm_gw_ip_address') }}
